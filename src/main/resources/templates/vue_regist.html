<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>哪都通注册</title>
	<link rel="shortcut icon" href="./img_head/ico/ico.ico" type="image/x-icon">
	<script type="text/javascript" src="./js/vue.js"></script>
	<link rel="stylesheet" type="text/css" href="./element-ui/lib/theme-chalk/index.css">
	<script type="text/javascript" src="./element-ui/lib/index.js"></script>
	<script type="text/javascript" src="./js/jquery-3.3.1.min.js"></script>
	<script type="text/javascript" src="./js/axios.js"></script>
	<style type="text/css">
	.el-header,.el-footer {
     background-color: #E6A23C;
      width: 100%; 
   }
   .el-main{
    background-color: white;
    width: 100%;
    height: 600px;
   }
   .el-footer p{
      text-align: center;
    }
    #div1{
		top: 0;
		left: 0;
		bottom: 0;
		right: 0;
		margin: auto;
    	width: 800px;
    	height: 600px;
    	background-color: #DCDFE6;
    	border-radius: 30px;
    }
	.el-form{
		margin-left: 200px;
	}
	</style>
</head>
<body>
	<div id="div">
	<el-container>
  <el-header>
  	<el-image
      style="width: 100px; height: 60px; float: left; margin-left: -20px;"
      :src="logo"
      :fit="none"></el-image>
      <p style="color: white; float: left; margin-left: 10px;">哪都通，一个什么都做的神秘机构</p>
  </el-header>
  <el-main>
		<div id="div1">
<el-form :model="DataForm" status-icon  ref="DataForm" size="medium" label-width="100px" :label-position="left">
            <span style="color: #F56C6C; font-size: 10px; margin-left: 100px;" >{{nameerr}}</span>
          <el-form-item label="用户名" prop="username" :rules="[
           { required: true, message: '用户号不能为空！', trigger: 'blur' },
           { pattern: /^[A-Za-z0-9\u4e00-\u9fa5]+$/, message: '不允许输入空格等特殊符号'}
          ]">
          <el-col :span="8">
          <el-input  clearable placeholder="请输入用户名" v-model="DataForm.username" ref="uname"></el-input>
          </el-col>
         </el-form-item>
         <span style="color: #F56C6C; font-size: 10px; margin-left: 100px;" >{{pwderr}}</span>
         <el-form-item label="密码" prop="passwd1" :rules="[
          { required: true, message: '密码不能为空！', trigger: 'blur' },
          { min: 6, message: '密码不少于6个长度', trigger: 'blur'}
         ]"> 
         <el-col :span="8">
          <el-input  type="password" clearable placeholder="请输入密码" v-model="DataForm.passwd1" ref="upwd"></el-input>
          </el-col>
         </el-form-item>
		<el-form-item label="确认密码" prop="passwd2" :rules="[
          { required: true, message: '密码不能为空！', trigger: 'blur' },
          { min: 6, message: '密码不少于6个长度', trigger: 'blur'}
         
         ]"> 
         <el-col :span="8">
          <el-input  type="password" clearable placeholder="请再次输入密码" v-model="DataForm.passwd2" ></el-input>
          </el-col>
         </el-form-item>
         <el-form-item label="密保问题1" prop="security1" :rules="[
         { required: true, message: '密保问题1不能为空！', trigger: 'blur' }]">
         	<el-col :span="10">
		    <el-select v-model="DataForm.security1" placeholder="请选择设置密保问题1">
                <el-option label="您配偶的姓名是？" value="您配偶的姓名是？"></el-option>
                <el-option label="您母亲的姓名是？" value="您母亲的姓名是？"></el-option>
                <el-option label="您父亲的姓名是？" value="您父亲的姓名是？"></el-option>
                <el-option label="您小学班主任的名字是？" value="您小学班主任的名字是？"></el-option>
                <el-option label="您初中班主任的名字是？" value="您初中班主任的名字是？"></el-option>
                <el-option label="您高中班主任的名字是？" value="您高中班主任的名字是？"></el-option>
                <el-option label="您最熟悉的童年好友名字是？" value="您最熟悉的童年好友名字是？"></el-option>
                <el-option label="您最熟悉的学校宿舍舍友名字是？" value="您最熟悉的学校宿舍舍友名字是？"></el-option>
                <el-option label="对您影响最大的人名字是？" value="对您影响最大的人名字是？"></el-option>
                <el-option label="您的学号（或工号）是？" value="您的学号（或工号）是？"></el-option>
		    </el-select>
		    </el-col>
		  </el-form-item>
		  <el-form-item label="答案1" prop="answer1" :rules="[
           { required: true, message: '请设置密保答案1！', trigger: 'blur' },
           { pattern: /^[A-Za-z0-9\u4e00-\u9fa5]+$/, message: '不允许输入空格等特殊符号'}
          ]">
          <el-col :span="8">
          <el-input  clearable placeholder="请输入答案1" v-model="DataForm.answer1" ></el-input>
          </el-col>
         </el-form-item>
         
		  <el-form-item label="密保问题2" prop="security2" :rules="[
         { required: true, message: '请设置密保问题2！', trigger: 'blur' }]">
         	<el-col :span="10">
		    <el-select v-model="DataForm.security2" placeholder="请选择设置密保问题2">
                <el-option label="您配偶的姓名是？" value="您配偶的姓名是？"></el-option>
                <el-option label="您母亲的姓名是？" value="您母亲的姓名是？"></el-option>
                <el-option label="您父亲的姓名是？" value="您父亲的姓名是？"></el-option>
                <el-option label="您小学班主任的名字是？" value="您小学班主任的名字是？"></el-option>
                <el-option label="您初中班主任的名字是？" value="您初中班主任的名字是？"></el-option>
                <el-option label="您高中班主任的名字是？" value="您高中班主任的名字是？"></el-option>
                <el-option label="您最熟悉的童年好友名字是？" value="您最熟悉的童年好友名字是？"></el-option>
                <el-option label="您最熟悉的学校宿舍舍友名字是？" value="您最熟悉的学校宿舍舍友名字是？"></el-option>
                <el-option label="对您影响最大的人名字是？" value="对您影响最大的人名字是？"></el-option>
                <el-option label="您的学号（或工号）是？" value="您的学号（或工号）是？"></el-option>
		    </el-select>
		    </el-col>
		  </el-form-item>
		  <el-form-item label="答案2" prop="answer2" :rules="[
           { required: true, message: '请设置密保答案2！', trigger: 'blur' },
           { pattern: /^[A-Za-z0-9\u4e00-\u9fa5]+$/, message: '不允许输入空格等特殊符号'}
          ]">
          <el-col :span="8">
          <el-input  clearable placeholder="请输入答案2" v-model="DataForm.answer2" ></el-input>
          </el-col>
         </el-form-item>
    <span style="color: #F56C6C; font-size: 10px; margin-left: 100px;" >{{phoneerr}}</span>
          <el-form-item label="手机号" prop="userphone" :rules="[
           { required: true, message: '手机号不能为空！', trigger: 'blur' },
          { type: 'number', message: '手机号格式错误！', trigger: ['blur', 'change'] },
          { pattern: /^[A-Za-z0-9\u4e00-\u9fa5]+$/, message: '不允许输入空格等特殊符号'},
          { pattern: /^[1][3|5|7|8|9][0-9]+$/, message: '手机号格式错误'}
          ]">
          <el-col :span="8">
          <el-input  clearable placeholder="请输入手机号" v-model.number="DataForm.userphone" ref="uphone"></el-input>
          </el-col>
          <el-link type="primary" @click="sendPhone" :underline="false" :disabled="disabled" >{{code}}</el-link>
         </el-form-item>
    <span style="color: #F56C6C; font-size: 10px; margin-left: 100px;" >{{codeerr}}</span>
      	<el-form-item label="验证码" prop="vcode" :rules="[
          { required: true, message: '验证码不能为空！', trigger: 'blur' },
          { min: 4, message: '请输入4个长度的验证码', trigger: 'blur'}
         ]"> 
         <el-col :span="8">
          <el-input  clearable placeholder="请输入验证码" v-model="DataForm.vcode" ref="ucode"></el-input>
          </el-col>
         </el-form-item>
         
         <el-form-item>
          <el-button type="primary" @click="submitForm('DataForm')">注册</el-button>
          <el-link type="primary" :underline="false" style="margin-left: 30px;" href="/login">已有账号，直接登录</el-link>
      </el-form-item>
      </el-form>
		</div>
  </el-main>
  <el-footer>
    <p style="color: white;">@Copyright 2021 - 2022 侵权必究</p>
  </el-footer>
</el-container>
	</div>
</body>
<script type="text/javascript">
new Vue({
	el:"#div",
	data:{
		logo:"img_head/ico/logo.jpg",
		DataForm:{
      			username:"",
      			passwd1:"",
      			passwd2:"",
      			security1:"",
      			answer1:"",
      			security2:"",
      			answer2:"",
      			userphone:"",
      			vcode:"",
      		},
      	code:"点击获取验证码",
      	disabled:false,
        nameerr:"",
        phoneerr:"",
        pwderr:"",
        codeerr:"",
	},
	methods:{
			sendPhone:function(){
                var that=this;
                if(that.DataForm.userphone==""){
                    that.phoneerr="手机号不能为空!";
                }else {
                    axios.post("/sendphoneAndverifyphone", "phone=" + that.DataForm.userphone)
                        .then(function (response) {
                            if (response.data == "手机号已被注册") {
                                that.phoneerr = "手机号已被注册!";
                                that.$refs.uphone.focus();
                            } else {
                                let seconds = 60;
                                that.disabled = true;
                                that.code = "已经发送(" + seconds + "s)";
                                var time = setInterval(function () {
                                    seconds = seconds - 1;
                                    that.disabled = true;
                                    that.code = "已经发送(" + seconds + "s)";
                                    let i = seconds;
                                    if (i < 0) {
                                        i = 1;
                                        clearInterval(time);
                                        that.disabled = false;
                                        that.code = "点击获取验证码";
                                    }
                                }, 1000);
                                alert(response.data);
                            }
                        }, function (err) {
                            alert(err);
                        });
                }
			},
			submitForm:function(DataForm){
				var that = this;
			this.$refs[DataForm].validate((valid) => {
	          if (valid) {
                  axios.post("/registUser","username="+that.DataForm.username+"&pwd1="+that.DataForm.passwd1+"&pwd2="+that.DataForm.passwd2+"&security1="+that.DataForm.security1+"&answer1="+that.DataForm.answer1+"&security2="+that.DataForm.security2+"&answer2="+that.DataForm.answer2+"&phone="+that.DataForm.userphone+"&code="+that.DataForm.vcode)
                      .then(function(response){
                          if(response.data==true){
                              that.nameerr="";
                              that.phoneerr="";
                              that.pwderr="";
                              that.codeerr="";
                              that.$message({
                                  type: 'success',
                                  message: '注册成功!,即将跳转登录页面'
                              });
                              setTimeout(() => {
                                  location.href="/login";
                              }, 2000);
                          }else{
                              if(response.data=="用户名已存在!"){
                                  that.nameerr=response.data;
                                  that.$refs.uname.focus();
                                  that.DataForm.username="";
                                  that.phoneerr="";
                                  that.pwderr="";
                                  that.codeerr="";
                              }else if(response.data=="两次密码不一致!"){
                                  that.pwderr=response.data;
                                  that.$refs.upwd.focus();
                                  that.DataForm.passwd1="";
                                  that.DataForm.passwd2="";
                                  that.nameerr="";
                                  that.phoneerr="";
                                  that.codeerr="";
                              }else if(response.data=="验证码不正确!"){
                                  that.codeerr=response.data;
                                  that.$refs.ucode.focus();
                                  that.DataForm.v_code="";
                                  that.nameerr="";
                                  that.phoneerr="";
                                  that.pwderr="";
                              }else {
                                  that.phoneerr=response.data;
                                  that.$refs.uphone.focus();
                                  that.DataForm.userphone="";
                                  that.nameerr="";
                                  that.pwderr="";
                                  that.codeerr="";
                              }
                          }
                      },function(err){
                          alert(err);
                      });
	          } else {
	            console.log('error submit!!');
	            return false;
	          }
       	 	});
			}
	}
})
</script>
</html>